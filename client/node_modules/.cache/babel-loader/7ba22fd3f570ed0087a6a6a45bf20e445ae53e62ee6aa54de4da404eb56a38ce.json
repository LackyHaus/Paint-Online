{"ast":null,"code":"import \"core-js/modules/es.array-buffer.detached.js\";\nimport \"core-js/modules/es.array-buffer.transfer.js\";\nimport \"core-js/modules/es.array-buffer.transfer-to-fixed-length.js\";\nimport \"core-js/modules/es.typed-array.to-reversed.js\";\nimport \"core-js/modules/es.typed-array.to-sorted.js\";\nimport \"core-js/modules/es.typed-array.with.js\";\nimport canvasState from \"@/store/canvasState\";\nimport Brush from \"@/tools/Brush\";\nexport default class ToolsSync {\n  constructor(msg, socket, id) {\n    this.msg = msg;\n    this.socket = socket;\n    this.id = id;\n    this.ctx = canvasState.ctx;\n    this.ctx.strokeStyle = msg.figure.color;\n    this.ctx.fillStyle = msg.figure.color;\n    this.ctx.lineWidth = msg.figure.width;\n    this.handleDraw();\n  }\n  handleDraw() {\n    const {\n      figure\n    } = this.msg;\n    switch (figure.type) {\n      case \"brush\":\n        Brush.draw(this.ctx, figure.x, figure.y);\n        break;\n      case \"rect\":\n        this.ctx.rect(figure.x, figure.y, figure.w, figure.h);\n        this.ctx.fill();\n        this.ctx.stroke();\n        break;\n      case \"circle\":\n        // Добавьте логику для рисования круга\n        break;\n      case \"eraser\":\n        // Добавьте логику для ластика\n        break;\n      case \"line\":\n        // Добавьте логику для рисования линии\n        break;\n      case \"up\":\n        {\n          this.ctx.beginPath();\n          this.sendCanvasState(this.socket, this.id);\n          break;\n        }\n      case \"canvasState\":\n        {\n          if (figure.canvasState === \"\") {\n            return;\n          }\n          // const img = new Image();\n          // img.src = figure.canvasState;\n          // img.onload = () => {\n          //   this.ctx.clearRect(0, 0, canvasState.canvas.width, canvasState.canvas.height);\n          //   this.ctx.drawImage(img, 0, 0);\n          // };\n\n          const buffer = new Uint8Array(JSON.parse(figure.canvasState)).buffer;\n          const view = new DataView(buffer);\n          const width = view.getUint32(0, true);\n          const height = view.getUint32(4, true);\n          const imageData = new ImageData(new Uint8ClampedArray(buffer, 8), width, height);\n          const ctx = canvasState.canvas.getContext('2d');\n          ctx.putImageData(imageData, 0, 0);\n          break;\n        }\n      default:\n        console.log(\"Unknown figure type:\", figure.type);\n    }\n  }\n  // eslint-disable-next-line\n  sendCanvasState(socket, id) {\n    // socket.send(\n    //   JSON.stringify({\n    //     id,\n    //     method: \"save\",\n    //     figure: {\n    //       type: \"canvasState\",\n    //       canvasState: canvasState.canvas.toDataURL(),\n    //     },\n    //   })\n    // );\n\n    const ctx = canvasState.canvas.getContext('2d');\n    const width = canvasState.canvas.width;\n    const height = canvasState.canvas.height;\n    const imageData = ctx.getImageData(0, 0, width, height);\n    const data = imageData.data; // Uint8ClampedArray\n\n    // Создадим общий буфер:\n    //  4 байта под ширину\n    //  4 байта под высоту\n    //  остаток под сами пиксели\n    const buffer = new ArrayBuffer(8 + data.length);\n    const view = new DataView(buffer);\n\n    // Запишем ширину/высоту (Uint32, порядок little-endian)\n    view.setUint32(0, width, true);\n    view.setUint32(4, height, true);\n\n    // Копируем сами пиксели (начиная с 8-го байта буфера)\n    new Uint8Array(buffer, 8).set(data);\n\n    // Отправим буфер на сервер\n    socket.send(JSON.stringify({\n      id,\n      method: \"save\",\n      figure: {\n        type: \"canvasState\",\n        canvasState: JSON.stringify(buffer)\n      }\n    }));\n  }\n}","map":{"version":3,"names":["canvasState","Brush","ToolsSync","constructor","msg","socket","id","ctx","strokeStyle","figure","color","fillStyle","lineWidth","width","handleDraw","type","draw","x","y","rect","w","h","fill","stroke","beginPath","sendCanvasState","buffer","Uint8Array","JSON","parse","view","DataView","getUint32","height","imageData","ImageData","Uint8ClampedArray","canvas","getContext","putImageData","console","log","getImageData","data","ArrayBuffer","length","setUint32","set","send","stringify","method"],"sources":["D:/Vue Projects/paintonline/client/src/utils/toolsSync.js"],"sourcesContent":["import canvasState from \"@/store/canvasState\";\r\nimport Brush from \"@/tools/Brush\";\r\n\r\nexport default class ToolsSync {\r\n  constructor(msg, socket, id) {\r\n    this.msg = msg;\r\n    this.socket = socket;\r\n    this.id = id;\r\n    this.ctx = canvasState.ctx;\r\n    this.ctx.strokeStyle = msg.figure.color;\r\n    this.ctx.fillStyle = msg.figure.color;\r\n    this.ctx.lineWidth = msg.figure.width;\r\n    this.handleDraw();\r\n  }\r\n\r\n  handleDraw() {\r\n    const { figure } = this.msg;\r\n\r\n    switch (figure.type) {\r\n      case \"brush\":\r\n        Brush.draw(this.ctx, figure.x, figure.y);\r\n        break;\r\n\r\n      case \"rect\":\r\n        this.ctx.rect(figure.x, figure.y, figure.w, figure.h);\r\n        this.ctx.fill();\r\n        this.ctx.stroke();\r\n        break;\r\n\r\n      case \"circle\":\r\n        // Добавьте логику для рисования круга\r\n        break;\r\n\r\n      case \"eraser\":\r\n        // Добавьте логику для ластика\r\n        break;\r\n\r\n      case \"line\":\r\n        // Добавьте логику для рисования линии\r\n        break;\r\n\r\n      case \"up\": {\r\n        this.ctx.beginPath();\r\n        this.sendCanvasState(this.socket, this.id);\r\n        break;\r\n      }\r\n\r\n      case \"canvasState\": {\r\n        if (figure.canvasState === \"\") {\r\n          return;\r\n        }\r\n        // const img = new Image();\r\n        // img.src = figure.canvasState;\r\n        // img.onload = () => {\r\n        //   this.ctx.clearRect(0, 0, canvasState.canvas.width, canvasState.canvas.height);\r\n        //   this.ctx.drawImage(img, 0, 0);\r\n        // };\r\n\r\n        const buffer = new Uint8Array(JSON.parse(figure.canvasState)).buffer;\r\n        const view = new DataView(buffer);\r\n        const width = view.getUint32(0, true);\r\n        const height = view.getUint32(4, true);\r\n        const imageData = new ImageData(new Uint8ClampedArray(buffer, 8), width, height);\r\n        const ctx = canvasState.canvas.getContext('2d');\r\n        ctx.putImageData(imageData, 0, 0);\r\n        \r\n        break;\r\n      }\r\n\r\n      default:\r\n        console.log(\"Unknown figure type:\", figure.type);\r\n    }\r\n  }\r\n// eslint-disable-next-line\r\n  sendCanvasState(socket, id) {\r\n    // socket.send(\r\n    //   JSON.stringify({\r\n    //     id,\r\n    //     method: \"save\",\r\n    //     figure: {\r\n    //       type: \"canvasState\",\r\n    //       canvasState: canvasState.canvas.toDataURL(),\r\n    //     },\r\n    //   })\r\n    // );\r\n\r\n    const ctx = canvasState.canvas.getContext('2d');\r\n    const width = canvasState.canvas.width;\r\n    const height = canvasState.canvas.height;\r\n    const imageData = ctx.getImageData(0, 0, width, height);\r\n    const data = imageData.data; // Uint8ClampedArray\r\n\r\n    // Создадим общий буфер:\r\n    //  4 байта под ширину\r\n    //  4 байта под высоту\r\n    //  остаток под сами пиксели\r\n    const buffer = new ArrayBuffer(8 + data.length);\r\n    const view = new DataView(buffer);\r\n\r\n    // Запишем ширину/высоту (Uint32, порядок little-endian)\r\n    view.setUint32(0, width, true);\r\n    view.setUint32(4, height, true);\r\n\r\n    // Копируем сами пиксели (начиная с 8-го байта буфера)\r\n    new Uint8Array(buffer, 8).set(data);\r\n\r\n    // Отправим буфер на сервер\r\n    socket.send(\r\n      JSON.stringify({\r\n        id,\r\n        method: \"save\",\r\n        figure: {\r\n          type: \"canvasState\",\r\n          canvasState: JSON.stringify(buffer),\r\n        },\r\n      })\r\n    );\r\n\r\n  }\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}